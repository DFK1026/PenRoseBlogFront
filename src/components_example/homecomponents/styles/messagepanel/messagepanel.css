/* MessagePanel styles: transparent container with animated gradient border and overlay */
.messagepanel {
  position: relative;
  width: 100%;
  max-width: 100%; /* 使其随父容器 1/4 宽度伸缩 */
  margin: 0 auto;
  border-radius: 16px;
  background: transparent; /* 背景透明 */
  /* 新增：让面板撑满父容器，并用列布局 */
  height: 100%;
  display: flex;
  flex-direction: column;
}
/* 动态渐变流光边框（仅边框可见，内部透明） */
.messagepanel::before {
  content: "";
  position: absolute;
  inset: 0; /* 全覆盖 */
  padding: 1.5px; /* 边框粗细 */
  border-radius: inherit;
  background: conic-gradient(
    from var(--mp-angle, 0deg),
    #6ea3ff,
    #b36bff,
    #00e5ff,
    #6ea3ff
  );
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite: xor; /* Chrome/Safari */
  mask-composite: exclude;     /* Firefox */
  pointer-events: none; /* 允许内部交互 */
  animation: messagepanel-spin 8s linear infinite;
}
/* 面板流光覆层（柔和蒙版，不遮挡交互） */
.messagepanel::after {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  pointer-events: none;
  background-size: 200% 200%;
  animation: messagepanel-shimmer 6s ease-in-out infinite;
}
@keyframes messagepanel-spin { to { --mp-angle: 360deg; } }
@keyframes messagepanel-shimmer {
  0% { background-position: 200% 0; }
  50% { background-position: 0 100%; }
  100% { background-position: -200% 0; }
}

/* Header 居中 */
.messagepanel-header { padding: 14px 18px 6px; display: flex; align-items: center; justify-content: center; }
.messagepanel-header h3 { margin: 0; font-size: 18px; font-weight: 700; color: #1a237e; text-align: center; }

/* 主体区域：上方列表(3) + 下方输入(1) */
.messagepanel-main {
  flex: 1 1 auto;
  display: flex;
  flex-direction: column;
  min-height: 0; /* 允许子元素滚动 */
}

/* 列表容器：在展开时占据剩余空间，允许内部滚动；收起时隐藏 */
.messagepanel-listwrap { 
  flex: 1 1 0;         /* 占据剩余空间 */
  min-height: 0;       /* 允许子元素滚动 */
  overflow: hidden;    /* 自身不滚动，交给内部 body */
  display: none;       /* 默认收起 */
}
.messagepanel.expanded .messagepanel-listwrap { display: block; }
.messagepanel-togglewrap { display: flex; justify-content: center; padding: 6px 0; pointer-events: auto; }
.messagepanel-toggle { 
  padding: 6px 12px; border: none; border-radius: 12px; color: #0f1a3a; font-weight: 600; cursor: pointer;
  background: rgba(255,255,255,0.8); box-shadow: 0 2px 10px rgba(0,0,0,0.08);
}
.messagepanel-toggle.on { color: #1a237e; }
.messagepanel-toggle.off { color: #1a237e; }

/* List */
.messagepanel-body {
  padding: 6px 8px 14px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  height: 100%;           /* 跟随父容器高度，形成滚动容器 */
  overflow-y: auto;       /* 内部滚动 */
  min-height: 0;          /* 避免高度撑破 */
  scrollbar-width: none;  /* Firefox 隐藏滚动条 */
}
.messagepanel-body::-webkit-scrollbar { width: 0; height: 0; } /* WebKit 隐藏滚动条 */
.messagepanel-loading, .messagepanel-error, .messagepanel-empty { padding: 18px; text-align: center; color: #37474f; }
.messagepanel-error { color: #c62828; }

/* Composer */
.messagepanel-compose { display: flex; gap: var(--mp-gap, 12px); padding: 8px 18px 12px; align-items: flex-start; flex: 0 0 auto; --mp-avatar: 40px; --mp-gap: 12px; }
.messagepanel-compose-avatar { width: var(--mp-avatar, 40px); height: var(--mp-avatar, 40px); border-radius: 50%; overflow: hidden; flex: 0 0 var(--mp-avatar, 40px); background: #eee; }
.messagepanel-compose-avatar img { width: 100%; height: 100%; object-fit: cover; }
.messagepanel-avatar-placeholder { width: 100%; height: 100%; background: #e0e0e0; }
.messagepanel-compose-main { flex: 1; }
.messagepanel-compose-inputwrap { position: relative; }
.messagepanel-compose-main textarea {
  width: 100%; box-sizing: border-box; border: 1px solid rgba(8,52,255,0.25);
  border-radius: 12px; padding: 12px 36px 22px 12px; min-height: 88px; resize: vertical; outline: none;
  font-size: 14px; background: rgba(255,255,255,0.95); color: #333;
}
.messagepanel-compose-main textarea::placeholder { color: #999; }
.messagepanel-counter-inbox { position: absolute; right: 10px; bottom: 8px; font-size: 12px; color: #607d8b; pointer-events: none; }
.messagepanel-counter-inbox.warn { color: #ef6c00; }
.messagepanel-compose-toolbar { display: flex; justify-content: center; align-items: center; margin-top: 8px; width: calc(100% + var(--mp-avatar, 40px) + var(--mp-gap, 12px)); margin-left: calc((var(--mp-avatar, 40px) + var(--mp-gap, 12px)) * -1); }
/* 旧的计数器样式保留但不再使用于工具栏 */
.messagepanel-counter { font-size: 12px; color: #607d8b; }
.messagepanel-counter.warn { color: #ef6c00; }
.messagepanel-send { padding: 6px 14px; border-radius: 8px; border: none; color: #fff; background: linear-gradient(90deg, #0834ff, #4f8cff); cursor: pointer; box-shadow: 0 1px 6px rgba(8,52,255,0.22); font-size: 14px; }
.messagepanel-send:disabled { opacity: .6; cursor: not-allowed; box-shadow: none; }
.messagepanel-postmsg { margin-top: 6px; font-size: 12px; color: #2e7d32; }

.messagepanel-item { display: flex; gap: 10px; padding: 10px 12px; margin: 0 8px; background: rgba(255,255,255,0.78); border: 1px solid rgba(8,52,255,0.10); border-radius: 12px; box-shadow: 0 1px 6px rgba(0,0,0,0.06); align-items: flex-start; }
.messagepanel-item-avatar { width: 36px; height: 36px; border-radius: 50%; overflow: hidden; flex: 0 0 36px; background: #eee; }
.messagepanel-item-avatar img { width: 100%; height: 100%; object-fit: cover; }
.messagepanel-item-main { flex: 1; min-width: 0; display: grid; grid-template-rows: auto 1fr auto; row-gap: 4px; }
/* 顶部：昵称 */
.messagepanel-item-meta { margin: 0; }
.messagepanel-item-nickname { font-weight: 700; color: #1a237e; line-height: 1.2; white-space: normal; word-break: break-word; }
/* 中部：内容，自动换行 */
.messagepanel-item-content { color: #333; white-space: pre-wrap; word-break: break-word; overflow-wrap: anywhere; }
/* 底部：时间 */
.messagepanel-item-time { font-size: 12px; color: #78909c; align-self: end; justify-self: end; text-align: right; }

@media (max-width: 560px) {
  .messagepanel { border-radius: 12px; }
  .messagepanel-item { margin: 0; }
}
